<!doctype html>
<html lang="en">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>TickEasy | 建立活動</title>

	<!--Primary Meta Tags-->
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<meta name="title" content="TickEasy | 建立活動" />
	<meta name="author" content="TIA203-G2" />
	<meta name="description"
		content="TickEasy is build by Free Bootstrap 5 Admin Dashboard, 30 example pages using Vanilla JS." />
	<meta name="keywords" content="TickEasy, ticket, concert, ticket admin dashboard" />
	<link rel="icon" href="../common/assets/img/Member_icon.ico">
	<!--Fonts-->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fontsource/source-sans-3@5.0.12/index.css"
		integrity="sha256-tXJfXfp6Ewt1ilPzLDtQnJV4hclT9XuaZUKyUvmyr+Q=" crossorigin="anonymous" />
	<!--Third Party Plugin(OverlayScrollbars)-->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/overlayscrollbars@2.10.1/styles/overlayscrollbars.min.css"
		integrity="sha256-tZHrRjVqNSRyWg2wbppGnT833E/Ys0DHWGwT04GiqQg=" crossorigin="anonymous" />
	<!--Third Party Plugin(Bootstrap Icons)-->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
		integrity="sha256-9kPW/n5nn53j4WMRYAxe9c1rCY96Oogo/MKSVdKzPmI=" crossorigin="anonymous" />
	<!--Required Plugin(AdminLTE)-->
	<link rel="stylesheet" href="../common/css/adminlte.css" />
	<!-- apexcharts -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/apexcharts@3.37.1/dist/apexcharts.css"
		integrity="sha256-4MX+61mt9NVvvuPjUWdUdyfZfxSB1/Rf9WtqRHgG5S0=" crossorigin="anonymous" />
	<!--Summernote-->
	<link href="https://cdn.jsdelivr.net/npm/summernote@0.8.20/dist/summernote-lite.min.css" rel="stylesheet">
</head>

<body class="layout-fixed sidebar-expand-lg bg-body-tertiary">
	<div class="app-wrapper">
		<nav class="app-header navbar navbar-expand bg-body">
			<div class="container-fluid">
				<ul class="navbar-nav">
					<li class="nav-item"><a class="nav-link" data-lte-toggle="sidebar" href="#" role="button"> <i
								class="bi bi-list"></i>
						</a></li>
					<li class="nav-item d-none d-md-block"><a href="index.html" class="nav-link">Home</a></li>
				</ul>
				<ul class="navbar-nav ms-auto">
					<li class="nav-item"><a class="nav-link" href="#" data-lte-toggle="fullscreen"> <i
								data-lte-icon="maximize" class="bi bi-arrows-fullscreen"></i> <i
								data-lte-icon="minimize" class="bi bi-fullscreen-exit" style="display: none"></i>
						</a></li>
					<li class="nav-item dropdown user-menu"><a href="#" class="nav-link dropdown-toggle"
							data-bs-toggle="dropdown"> <img src="../common/assets/img/user2-128x128.png"
								class="user-image rounded-circle shadow" alt="User Image" /> <span
								class="d-none d-md-inline">Alexander Pierce</span>
						</a>
						<ul class="dropdown-menu dropdown-menu-lg dropdown-menu-end">
							<!--begin::User Image-->
							<li class="user-header text-bg-primary"><img src="../common/assets/img/user2-128x128.png"
									class="rounded-circle shadow" alt="User Image" />
								<p>
									Alexander Pierce - Web Developer <small>Member since
										Nov. 2023</small>
								</p>
							</li>
							<li class="user-body">
								<div class="row">
									<div class="col-6 text-center">
										<a href="#">活動場次</a><br> <a href="#" class="fs-4">1000</a>
									</div>
									<div class="col-6 text-center">
										<a href="#">Friends</a><br> <a href="#" class="fs-4">1000</a>
									</div>
								</div>
							</li>
							<li class="user-footer"><a href="#" class="btn btn-default btn-flat">Profile</a> <a href="#"
									class="btn btn-default btn-flat float-end">Sign out</a></li>
						</ul>
					</li>
				</ul>
			</div>
		</nav>
		<aside class="app-sidebar bg-body-secondary shadow" data-bs-theme="dark">
			<div class="sidebar-brand">
				<div class="brand-link">
					<a href="./index.html" class="brand-link"> <span class="brand-text fs-1">TickEasy</span>
					</a> <span class="brand-text fs-7">活動方</span>
				</div>
			</div>
			<div class="sidebar-wrapper">
				<nav class="mt-2">
					<ul class="nav sidebar-menu flex-column" data-lte-toggle="treeview" role="menu"
						data-accordion="false">
						<li class="nav-header">活動方</li>
						<li class="nav-item"><a href="./event_new.html" class="nav-link"> <i
									class="nav-icon bi bi-patch-plus-fill"></i>
								<p>建立活動</p>
							</a></li>
						<li class="nav-item"><a href="#" class="nav-link"> <i
									class="nav-icon bi bi-gear-wide-connected"></i>
								<p>
									活動管理 <i class="nav-arrow bi bi-chevron-right"></i>
								</p>
							</a>
							<ul class="nav nav-treeview">
								<li class="nav-item"><a href="./index.html" class="nav-link"> <i
											class="nav-icon bi bi-list-task"></i>
										<p>活動列表</p>
									</a></li>
							</ul>
						</li>
						<li class="nav-item"><a href="#" class="nav-link"> <i class="nav-icon bi bi bi-people-fill"></i>
								<p>
									會員管理 <i class="nav-arrow bi bi-chevron-right"></i>
								</p>
							</a>
							<ul class="nav nav-treeview">
								<li class="nav-item"><a href="./index.html" class="nav-link"> <i
											class="nav-icon bi bi-person-fill-gear"></i>
										<p>會員設定</p>
									</a></li>
								<li class="nav-item"><a href="./index.html" class="nav-link"> <i
											class="nav-icon bi bi-shield-lock-fill"></i>
										<p>會員密碼</p>
									</a></li>
							</ul>
						</li>
						<li class="nav-header">平台方</li>
						<li class="nav-item"><a href="#" class="nav-link"> <i
									class="nav-icon bi bi-gear-wide-connected"></i>
								<p>
									活動管理 <i class="nav-arrow bi bi-chevron-right"></i>
								</p>
							</a>
							<ul class="nav nav-treeview">
								<li class="nav-item"><a href="./index.html" class="nav-link"> <i
											class="nav-icon bi bi-calendar3-range-fill"></i>
										<p>活動列表</p>
									</a></li>
								<li class="nav-item"><a href="./index.html" class="nav-link"> <i
											class="nav-icon bi bi-ticket-perforated-fill"></i>
										<p>票券列表</p>
									</a></li>
							</ul>
						</li>
						<li class="nav-item"><a href="#" class="nav-link"> <i class="nav-icon bi bi bi-people-fill"></i>
								<p>
									會員管理 <i class="nav-arrow bi bi-chevron-right"></i>
								</p>
							</a>
							<ul class="nav nav-treeview">
								<li class="nav-item"><a href="./index.html" class="nav-link"> <i
											class="nav-icon bi bi-person-lines-fill"></i>
										<p>會員列表</p>
									</a></li>
								<li class="nav-item"><a href="./index.html" class="nav-link"> <i
											class="nav-icon bi bi-person-heart"></i>
										<p>購票者</p>
									</a></li>
								<li class="nav-item"><a href="./index.html" class="nav-link"> <i
											class="nav-icon bi bi-bookmark-check-fill"></i>
										<p>活動方</p>
									</a></li>
							</ul>
						</li>
						<li class="nav-item"><a href="#" class="nav-link"> <i class="nav-icon bi bi-cone-striped"></i>
								<p>
									平台管理 <i class="nav-arrow bi bi-chevron-right"></i>
								</p>
							</a>
							<ul class="nav nav-treeview">
								<li class="nav-item"><a href="./index.html" class="nav-link"> <i
											class="nav-icon bi bi-check2-square"></i>
										<p>活動單位審核</p>
									</a></li>
								<li class="nav-item"><a href="./index.html" class="nav-link"> <i
											class="nav-icon bi bi-backspace-reverse-fill"></i>
										<p>平台帳號管理</p>
									</a></li>
							</ul>
						</li>
						<li class="nav-item"><a href="#" class="nav-link"> <i
									class="nav-icon bi bi bi-person-hearts"></i>
								<p>
									粉絲交流管理 <i class="nav-arrow bi bi-chevron-right"></i>
								</p>
							</a>
							<ul class="nav nav-treeview">
								<li class="nav-item"><a href="./index.html" class="nav-link"> <i
											class="nav-icon bi bi-list-task"></i>
										<p>討論區列表</p>
									</a></li>
							</ul>
						</li>
					</ul>
				</nav>
			</div>
		</aside>
		<main class="app-main">
			<div class="app-content-header">
				<div class="container-fluid">
					<div class="row">
						<div class="col-sm-6">
							<h3 class="mb-0">檢視 Aespa演唱會</h3>
						</div>
						<div class="col-sm-6">
							<ol class="breadcrumb float-sm-end">
								<li class="breadcrumb-item"><a href="index.html">Home</a></li>
								<li class="breadcrumb-item"><a href="index.html">活動列表</a></li>
								<li class="breadcrumb-item active" aria-current="page">檢視
									Aespa演唱會</li>
							</ol>
						</div>
					</div>
				</div>
			</div>
			<div class="app-content">
				<div class="container-fluid">
					<!-- 標籤頁導航 -->
					<div class="row mb-3">
						<div class="col-12">
							<ul class="nav nav-tabs" id="myTab" role="tablist">
								<li class="nav-item" role="presentation">
									<button class="nav-link active" id="exchange-tab" data-bs-toggle="tab"
										data-bs-target="#exchange" type="button" role="tab" aria-controls="exchange"
										aria-selected="true">換票列表</button>
								</li>
								<li class="nav-item" role="presentation">
									<button class="nav-link" id="ticket-tab" data-bs-toggle="tab"
										data-bs-target="#ticket" type="button" role="tab" aria-controls="ticket"
										aria-selected="false">分票列表</button>
								</li>
							</ul>
						</div>
					</div>

					<!-- 標籤頁內容 -->
					<div class="tab-content" id="myTabContent">
						<!-- 換票列表 -->
						<div class="tab-pane fade show active" id="exchange" role="tabpanel"
							aria-labelledby="exchange-tab">
							<div class="card">
								<div class="card-header">
									<div class="row">
										<div class="col-md-6">
											<h3 class="card-title">換票列表</h3>
										</div>
										<div class="col-md-6 text-end">
											<div class="d-flex justify-content-end align-items-center">
												<label class="me-2 mb-0">目前檢視活動</label>
												<select class="form-select" id="eventSelect" style="width: auto;">
													<option value="">全部活動</option>
													<!-- 選項將由 JavaScript 動態載入 -->
												</select>
											</div>
										</div>
									</div>
								</div>
								<div class="card-body">
									<!-- 搜尋區域 -->
									<form class="mb-4">
										<div class="row g-3">
											<div class="col-md-6">
												<div class="input-group">
													<span class="input-group-text">搜尋</span> <input type="text"
														class="form-control" placeholder="請輸入關鍵字">
													<button class="btn btn-outline-secondary" type="button">
														<i class="bi bi-search"></i>
													</button>
												</div>
											</div>
											<div class="col-md-6">
												<div class="row g-2">
													<div class="col-auto">
														<label class="col-form-label">換票時間</label>
													</div>
													<div class="col">
														<input type="date" class="form-control" value="2025-02-01">
													</div>
													<div class="col-auto">
														<span class="col-form-label">~</span>
													</div>
													<div class="col">
														<input type="date" class="form-control" value="2025-05-01">
													</div>
												</div>
											</div>
											<div class="col-md-6">
												<div class="row g-2">
													<div class="col-auto">
														<label class="col-form-label">換票狀態：</label>
													</div>
													<div class="col">
														<select class="form-select" id="statusSelect">
															<option value="">全部</option>
															<!-- 選項將由 JavaScript 動態載入 -->
														</select>
													</div>
													<div class="col-auto">
														<button type="button" class="btn btn-outline-secondary"
															onclick="resetSearch()">
															<i class="bi bi-arrow-clockwise"></i> 重置
														</button>
													</div>
												</div>
											</div>
										</div>
									</form>

									<!-- 表格區域 -->
									<div class="table-responsive">
										<table class="table table-bordered table-striped">
											<thead>
												<tr>
													<th>換票ID</th>
													<th>換票方票券ID</th>
													<th>換票方member_id</th>
													<th>被換方票券ID</th>
													<th>被換方member_id</th>
													<th>換票成功時間</th>
													<th>狀態</th>
												</tr>
											</thead>
											<tbody>
												<!-- 資料將由JavaScript動態載入 -->
											</tbody>
										</table>
									</div>

									<!-- 分頁 -->
									<div class="row">
										<div class="col-12">
											<nav>
												<ul class="pagination justify-content-center">
													<!-- 分頁將由JavaScript動態生成 -->
												</ul>
											</nav>
										</div>
									</div>

									<!-- 返回按鈕 -->
									<div class="row mt-3">
										<div class="col-12 text-end">
											<button type="button" class="btn btn-secondary">回到活動列表</button>
										</div>
									</div>
								</div>
							</div>
						</div>

						<!-- 分票列表 -->
						<div class="tab-pane fade" id="ticket" role="tabpanel" aria-labelledby="ticket-tab">
							<div class="card">
								<div class="card-header">
									<h3 class="card-title">分票列表</h3>
								</div>
								<div class="card-body">
									<p>分票列表內容</p>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</main>
		<footer class="app-footer">
			<div class="float-end d-none d-sm-inline">TIA203-G2</div>
			<strong> Copyright &copy; 2025&nbsp; <a href="https://gamma.app/docs/TickEasy-gd84wknpd0a0roz?mode=doc"
					class="text-decoration-none">TickEasy</a>.
			</strong> All rights reserved.
		</footer>
	</div>
	<script src="https://code.jquery.com/jquery-3.7.1.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
	<!--begin::Third Party Plugin(OverlayScrollbars)-->
	<script src="https://cdn.jsdelivr.net/npm/overlayscrollbars@2.10.1/browser/overlayscrollbars.browser.es6.min.js"
		integrity="sha256-dghWARbRe2eLlIJ56wNB+b760ywulqK3DzZYEpsg2fQ=" crossorigin="anonymous"></script>
	<!--end::Third Party Plugin(OverlayScrollbars)-->
	<!--begin::Required Plugin(popperjs for Bootstrap 5)-->
	<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
		integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
		crossorigin="anonymous"></script>
	<!--end::Required Plugin(popperjs for Bootstrap 5)-->
	<!--begin::Required Plugin(Bootstrap 5)-->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
		integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
		crossorigin="anonymous"></script>
	<!--end::Required Plugin(Bootstrap 5)-->
	<!--begin::Required Plugin(AdminLTE)-->
	<script src="../common/js/adminlte.js"></script>
	<!--end::Required Plugin(AdminLTE)-->
	<!--begin::OverlayScrollbars Configure-->
	<script>
		const SELECTOR_SIDEBAR_WRAPPER = '.sidebar-wrapper';
		const Default = {
			scrollbarTheme: 'os-theme-light',
			scrollbarAutoHide: 'leave',
			scrollbarClickScroll: true,
		};
		document.addEventListener('DOMContentLoaded', function () {
			const sidebarWrapper = document.querySelector(SELECTOR_SIDEBAR_WRAPPER);
			if (sidebarWrapper && typeof OverlayScrollbarsGlobal?.OverlayScrollbars !== 'undefined') {
				OverlayScrollbarsGlobal.OverlayScrollbars(sidebarWrapper, {
					scrollbars: {
						theme: Default.scrollbarTheme,
						autoHide: Default.scrollbarAutoHide,
						clickScroll: Default.scrollbarClickScroll,
					},
				});
			}
		});
	</script>
	
	<!--end::OverlayScrollbars Configure-->
	<!-- OPTIONAL SCRIPTS -->
	<!--Summernote-->
	<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.20/dist/summernote-lite.min.js"></script>
	<!-- apexcharts -->
	<script src="https://cdn.jsdelivr.net/npm/apexcharts@3.37.1/dist/apexcharts.min.js"
		integrity="sha256-+vh8GkaU7C9/wbSLIcwq82tQ2wTf44aOHA8HlBMwRI8=" crossorigin="anonymous"></script>
	<!-- 換票列表管理功能 -->
	<script>
		// 全域變數
		let currentPage = 1;
		let pageSize = 10;
		let searchParams = {};

		// DOM 載入完成後初始化
		document.addEventListener('DOMContentLoaded', function () {
			initializePage();
			loadInitialData();
			bindEvents();
		});

		/**
		 * 初始化頁面
		 */
		function initializePage() {
			// 設定預設日期範圍
			const startDateInput = document.querySelector('input[type="date"]:first-of-type');
			const endDateInput = document.querySelector('input[type="date"]:last-of-type');

			if (startDateInput && endDateInput) {
				const today = new Date();
				const threeMonthsAgo = new Date(today.getFullYear(), today.getMonth() - 3, today.getDate());

				startDateInput.value = formatDate(threeMonthsAgo);
				endDateInput.value = formatDate(today);
			}
		}

		/**
		 * 載入初始資料
		 */
		async function loadInitialData() {
			try {
				console.log('=== 開始載入初始資料 ===');

				// 確保 DOM 完全載入
				await new Promise(resolve => setTimeout(resolve, 100));

				await Promise.all([
					loadEventList(),
					loadSwapStatusList()
				]);

				loadExchangeList();
			} catch (error) {
				console.error('載入初始資料失敗：', error);
				showError('載入初始資料失敗');
			}
		}

		/**
		 * 載入活動列表
		 */
		async function loadEventList() {
			try {
				const response = await fetch('/maven-tickeasy-v1/api/manager/ticket-exchange/events');
				const result = await response.json();

				if (result.success) {
					renderEventOptions(result.data);
				} else {
					console.error('載入活動列表失敗：', result.message);
				}
			} catch (error) {
				console.error('載入活動列表錯誤：', error);
			}
		}

		/**
		 * 載入換票狀態列表
		 */
		async function loadSwapStatusList() {
			try {
				console.log('=== 開始載入狀態列表 ===');

				const response = await fetch('/maven-tickeasy-v1/api/manager/ticket-exchange/swap-status');
				console.log('Status API Response status:', response.status);

				const result = await response.json();
				console.log('Status API 回應:', result);

				if (result.success) {
					console.log('準備渲染狀態選項，資料:', result.data);
					renderStatusOptions(result.data);
				} else {
					console.error('載入狀態列表失敗：', result.message);
				}
			} catch (error) {
				console.error('載入狀態列表錯誤：', error);
			}
		}

		/**
		 * 渲染活動選項
		 */
		function renderEventOptions(events) {
			const eventSelect = document.getElementById('eventSelect');
			if (!eventSelect) return;

			eventSelect.innerHTML = '<option value="">全部活動</option>';

			events.forEach(event => {
				const option = document.createElement('option');
				option.value = event.eventId;
				option.textContent = event.eventName;
				eventSelect.appendChild(option);
			});
		}

		/**
		 * 渲染狀態選項
		 */
		function renderStatusOptions(statusList) {
			console.log('=== renderStatusOptions 被呼叫 ===');
			console.log('接收到的狀態列表:', statusList);

			const statusSelect = document.getElementById('statusSelect');
			console.log('找到的 statusSelect 元素:', statusSelect);

			if (!statusSelect) {
				console.error('找不到 statusSelect 元素！');
				return;
			}

			statusSelect.innerHTML = '<option value="">全部</option>';

			statusList.forEach((status, index) => {
				console.log(`處理狀態 ${index}:`, status);
				const option = document.createElement('option');
				option.value = status.value;
				option.textContent = status.label;
				statusSelect.appendChild(option);
			});

			console.log('狀態選單選項數量:', statusSelect.options.length);
			console.log('=== renderStatusOptions 完成 ===');
		}

		/**
		 * 綁定事件處理器
		 */
		function bindEvents() {
			const searchButton = document.querySelector('.btn.btn-outline-secondary');
			if (searchButton) {
				searchButton.addEventListener('click', function (e) {
					e.preventDefault();
					performSearch();
				});
			}

			const eventSelect = document.getElementById('eventSelect');
			if (eventSelect) {
				eventSelect.addEventListener('change', function () {
					performSearch();
				});
			}

			const statusSelect = document.getElementById('statusSelect');
			if (statusSelect) {
				statusSelect.addEventListener('change', function () {
					performSearch();
				});
			}

			const backButton = document.querySelector('.btn.btn-secondary');
			if (backButton) {
				backButton.addEventListener('click', function () {
					window.location.href = './index.html';
				});
			}

			const keywordInput = document.querySelector('input[placeholder="請輸入關鍵字"]');
			if (keywordInput) {
				keywordInput.addEventListener('keypress', function (e) {
					if (e.key === 'Enter') {
						e.preventDefault();
						performSearch();
					}
				});
			}
		}

		/**
		 * 執行搜尋
		 */
		function performSearch() {
			currentPage = 1;

			const keyword = document.querySelector('input[placeholder="請輸入關鍵字"]')?.value || '';
			const startDate = document.querySelector('input[type="date"]:first-of-type')?.value || '';
			const endDate = document.querySelector('input[type="date"]:last-of-type')?.value || '';
			const eventId = document.getElementById('eventSelect')?.value || '';
			const swappedStatus = document.getElementById('statusSelect')?.value || '';

			searchParams = {
				keyword: keyword.trim(),
				startDate: startDate,
				endDate: endDate
			};

			if (eventId && eventId !== '') {
				searchParams.eventId = parseInt(eventId);
			}

			if (swappedStatus && swappedStatus !== '') {
				searchParams.swappedStatus = parseInt(swappedStatus);
			}

			loadExchangeList();
		}

		/**
		 * 載入換票列表
		 */
		async function loadExchangeList() {
			try {
				showLoading(true);

				const params = new URLSearchParams({
					page: currentPage,
					size: pageSize,
					...searchParams
				});

				for (let [key, value] of params.entries()) {
					if (!value || value === 'null') {
						params.delete(key);
					}
				}

				const response = await fetch(`/maven-tickeasy-v1/api/manager/ticket-exchange/swaps?${params.toString()}`);
				const result = await response.json();

				if (result.success) {
					renderExchangeTable(result.data.data);
					renderPagination(result.data);
				} else {
					showError('載入換票列表失敗：' + result.message);
				}
			} catch (error) {
				console.error('載入換票列表錯誤：', error);
				showError('載入換票列表時發生錯誤');
			} finally {
				showLoading(false);
			}
		}

		/**
		 * 渲染換票表格
		 */
		function renderExchangeTable(data) {
			const tbody = document.querySelector('#exchange .table tbody');
			if (!tbody) return;

			if (!data || data.length === 0) {
				tbody.innerHTML = '<tr><td colspan="7" class="text-center">暫無數據</td></tr>';
				return;
			}

			tbody.innerHTML = data.map(item => `
        <tr>
            <td>${item.commentId || '-'}</td>
            <td>${item.commentTicketId || '-'}</td>
            <td>${item.commentMemberId || '-'}</td>
            <td>${item.postTicketId || '-'}</td>
            <td>${item.postMemberId || '-'}</td>
            <td>${formatDisplayTime(item)}</td>
            <td>
                <span class="badge ${getStatusBadgeClass(item.swappedStatus)}">
                    ${getStatusText(item.swappedStatus)}
                </span>
            </td>
        </tr>
    `).join('');
		}

		/**
		 * 渲染分頁控制器
		 */
		function renderPagination(pageData) {
			const pagination = document.querySelector('.pagination');
			if (!pagination) return;

			const { currentPage: current, totalPages, hasPrevious, hasNext } = pageData;

			let paginationHTML = '';

			paginationHTML += `
        <li class="page-item ${current === 1 ? 'disabled' : ''}">
            <a class="page-link" href="#" onclick="goToPage(1)">第一頁</a>
        </li>
    `;

			paginationHTML += `
        <li class="page-item ${!hasPrevious ? 'disabled' : ''}">
            <a class="page-link" href="#" onclick="goToPage(${current - 1})">上一頁</a>
        </li>
    `;

			const startPage = Math.max(1, current - 3);
			const endPage = Math.min(totalPages, current + 3);

			for (let i = startPage; i <= endPage; i++) {
				paginationHTML += `
            <li class="page-item ${i === current ? 'active' : ''}">
                <a class="page-link" href="#" onclick="goToPage(${i})">${i}</a>
            </li>
        `;
			}

			paginationHTML += `
        <li class="page-item ${!hasNext ? 'disabled' : ''}">
            <a class="page-link" href="#" onclick="goToPage(${current + 1})">下一頁</a>
        </li>
    `;

			paginationHTML += `
        <li class="page-item ${current === totalPages ? 'disabled' : ''}">
            <a class="page-link" href="#" onclick="goToPage(${totalPages})">最末頁</a>
        </li>
    `;

			pagination.innerHTML = paginationHTML;
		}

		/**
		 * 跳轉到指定頁面
		 */
		function goToPage(page) {
			if (page < 1) return;
			currentPage = page;
			loadExchangeList();
		}

		/**
		 * 格式化顯示時間
		 */
		function formatDisplayTime(item) {
			let dateTime;
			if (item.swappedStatus === 2 && item.swappedTime) {
				dateTime = item.swappedTime;
			} else {
				dateTime = item.createTime;
			}
			return formatDateTime(dateTime);
		}

		/**
		 * 獲取狀態文字
		 */
		function getStatusText(status) {
			switch (status) {
				case 0:
					return '待換票';
				case 1:
					return '待確認';
				case 2:
					return '已換票';
				case 3:
					return '已取消';
				default:
					return '未知';
			}
		}

		/**
		 * 獲取狀態徽章樣式
		 */
		function getStatusBadgeClass(status) {
			switch (status) {
				case 0:
					return 'bg-warning';
				case 1:
					return 'bg-info';
				case 2:
					return 'bg-success';
				case 3:
					return 'bg-danger';
				default:
					return 'bg-secondary';
			}
		}

		/**
		 * 格式化日期時間
		 */
		function formatDateTime(dateTime) {
			if (!dateTime) return '-';

			const date = new Date(dateTime);
			const year = date.getFullYear();
			const month = String(date.getMonth() + 1).padStart(2, '0');
			const day = String(date.getDate()).padStart(2, '0');
			const hours = String(date.getHours()).padStart(2, '0');
			const minutes = String(date.getMinutes()).padStart(2, '0');

			return `${year}/${month}/${day} ${hours}:${minutes}`;
		}

		/**
		 * 格式化日期
		 */
		function formatDate(date) {
			const year = date.getFullYear();
			const month = String(date.getMonth() + 1).padStart(2, '0');
			const day = String(date.getDate()).padStart(2, '0');

			return `${year}-${month}-${day}`;
		}

		/**
		 * 顯示載入狀態
		 */
		function showLoading(show) {
			if (show) {
				const tbody = document.querySelector('.table tbody');
				if (tbody) {
					tbody.innerHTML = '<tr><td colspan="7" class="text-center">載入中...</td></tr>';
				}
			}
		}

		/**
		 * 顯示錯誤訊息
		 */
		function showError(message) {
			const alertHTML = `
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="bi bi-exclamation-triangle-fill"></i> ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    `;

			const container = document.querySelector('.app-content .container-fluid');
			if (container) {
				container.insertAdjacentHTML('afterbegin', alertHTML);

				setTimeout(() => {
					const alert = container.querySelector('.alert');
					if (alert) {
						alert.remove();
					}
				}, 3000);
			}
		}

		/**
		 * 重置搜尋條件
		 */
		function resetSearch() {
			const keywordInput = document.querySelector('input[placeholder="請輸入關鍵字"]');
			if (keywordInput) keywordInput.value = '';

			const statusSelect = document.getElementById('statusSelect');
			if (statusSelect) statusSelect.value = '';

			const eventSelect = document.getElementById('eventSelect');
			if (eventSelect) eventSelect.value = '';

			initializePage();

			searchParams = {};
			currentPage = 1;
			loadExchangeList();
		}

		// 匯出函數供全域使用
		window.goToPage = goToPage;
		window.resetSearch = resetSearch;
	</script>
</body>

</html>